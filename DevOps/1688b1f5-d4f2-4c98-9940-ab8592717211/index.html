<!DOCTYPE html>
<html lang="en" class="color-toggle-hidden">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark" />





    <meta name="description" content="1. EnvVar Configuration 2. Configuration Resouece 3. Immutable Configuration    1) Docker 2) Kubernetes     4. Configuration Template     Kubernetes Pattern
Part IV. Configuration Patterns 참고
 1. EnvVar Configuration    가장 간단한 방법이다. Config Data의 개수가 적고 단순할 때 사용하기 적합하다.
 default ENV는 이미지에 정의해준다.  1 2 3 4 5  FROMubuntu:latestENV BACKEND_URL &#34;/backend&#34;ENV PROFILE = &#34;DEV&#34;.">



    <title>Kubernetes configuration pattern에 대하여 | @hwangseonbi</title>

    <link rel="icon" href="/favicon/favicon-32x32.png" type="image/x-icon">

    <script src="/js/darkmode-ce906ea916.min.js"></script>

<link rel="preload" as="font" href="/fonts/Metropolis.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/fonts/LiberationSans.woff2" type="font/woff2" crossorigin="anonymous">

<link rel="preload" href="/main-5caf214477.min.css" as="style">
<link rel="stylesheet" href="/main-5caf214477.min.css" media="all">

<link rel="preload" href="/mobile-249b801e7d.min.css" as="style">
<link rel="stylesheet" href="/mobile-249b801e7d.min.css" media="screen and (max-width: 45rem)">

<link rel="preload" href="/print-f79fc3e5d7.min.css" as="style">
<link rel="stylesheet" href="/print-f79fc3e5d7.min.css" media="print">

<link rel="preload" href="/custom.css" as="style">
<link rel="stylesheet" href="/custom.css" media="all">

<link rel="alternate" type="application/rss+xml" href="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/index.xml" title="@hwangseonbi" />


<!-- Made with Geekdoc theme https://github.com/thegeeklab/hugo-geekdoc -->

    

</head>

<body itemscope itemtype="https://schema.org/WebPage">
    
<!-- geekdoc include: sprites/geekdoc.svg -->
<svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><symbol viewBox="-2.29 -2.29 28.57 28.57" id="gdoc_arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M24 10.526v2.947H5.755l8.351 8.421-2.105 2.105-12-12 12-12 2.105 2.105-8.351 8.421H24z"/></symbol><symbol viewBox="-2.29 -2.29 28.57 28.57" id="gdoc_arrow_left_alt" xmlns="http://www.w3.org/2000/svg"><path d="M5.965 10.526V6.035L0 12l5.965 5.965v-4.491H24v-2.947H5.965z"/></symbol><symbol viewBox="-2.29 -2.29 28.57 28.57" id="gdoc_arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M18.035 10.526V6.035L24 12l-5.965 5.965v-4.491H0v-2.947h18.035z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427 0 .808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></symbol><symbol viewBox="-2.29 -2.29 28.57 28.57" id="gdoc_bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15.268 4.392q.868 0 1.532.638t.664 1.506v17.463l-7.659-3.268-7.608 3.268V6.536q0-.868.664-1.506t1.532-.638h10.876zm4.34 14.144V4.392q0-.868-.638-1.532t-1.506-.664H6.537q0-.868.664-1.532T8.733 0h10.876q.868 0 1.532.664t.664 1.532v17.412z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_brightness_auto" xmlns="http://www.w3.org/2000/svg"><path d="M16.846 18.938h2.382L15.22 7.785h-2.44L8.772 18.938h2.382l.871-2.44h3.95zm7.087-9.062L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809zm-11.385 4.937L14 10.282l1.452 4.531h-2.904z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_brightness_dark" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565q-1.51 0-3.079.697 1.917.871 3.108 2.701T15.22 14t-1.191 4.037-3.108 2.701q1.568.697 3.079.697zm9.933-11.559L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_brightness_light" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079 0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565 8.743 8.743 6.565 14t2.178 5.257T14 21.435zm9.933-3.311v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809L27.999 14z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_cloud_off" xmlns="http://www.w3.org/2000/svg"><path d="M9.023 10.5H7q-1.914 0-3.281 1.395t-1.367 3.309 1.367 3.281T7 19.852h11.375zM3.5 4.976l1.477-1.477L24.5 23.022l-1.477 1.477-2.352-2.297H6.999q-2.898 0-4.949-2.051t-2.051-4.949q0-2.844 1.969-4.867t4.758-2.133zm19.086 5.578q2.242.164 3.828 1.832T28 16.351q0 3.008-2.461 4.758l-1.695-1.695q1.805-.984 1.805-3.063 0-1.422-1.039-2.461t-2.461-1.039h-1.75v-.602q0-2.68-1.859-4.539t-4.539-1.859q-1.531 0-2.953.711l-1.75-1.695Q11.431 3.5 14.001 3.5q2.953 0 5.496 2.078t3.09 4.977z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75 0 10-3.501.001 1.75 1.75 0 003.501-.001zm0-21a1.75 1.75 0 10-3.501.001A1.75 1.75 0 009.917 3.5zm11.666 2.333a1.75 1.75 0 10-3.501.001 1.75 1.75 0 003.501-.001zm1.75 0a3.502 3.502 0 01-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502 0 011.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502 0 014.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502 0 01-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502 0 01-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277 0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352 0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46 0v3.155h-3.155v-3.155h3.155zm-6.384 0v3.155h-3.23v-3.155h3.23z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277 0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277 0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753L15.247.529a1.803 1.803 0 00-2.55 0l-2.84 2.84 2.137 2.137a2.625 2.625 0 013.501 3.501l3.499 3.499a2.625 2.625 0 11-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626 0 11-1.75 0v-7.3a2.626 2.626 0 01-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805 0 000 2.551l12.225 12.224a1.803 1.803 0 002.55 0l12.168-12.168a1.805 1.805 0 000-2.551z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833 0 15.999 7.166 15.999 15.999 0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771 0-.521.021-2.25.021-4.396 0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896 0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032 0 00-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291 0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896 0 1.333.021 2.583.021 2.979 0 .417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25 0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229 0 .375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354 0 .396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187 0-.333.104-.333.229 0 .146.146.25.354.229.187 0 .333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034L14 26.888.442 17.048a1.09 1.09 0 01-.39-1.203l1.578-4.811zm7.217 0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548 0 011.031 0zm20.618 9.559l1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548 0 011.031 0z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11 0 01-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125 0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339 0 8.535 3.125 8.535 8.357 0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_keyborad_arrow_down" xmlns="http://www.w3.org/2000/svg"><path d="M3.281 5.36L14 16.079 24.719 5.36 28 8.641l-14 14-14-14z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_keyborad_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25L22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_keyborad_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25L18.375 16 6.125 3.75 9.875 0l15.999 15.999L9.875 31.998z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305 0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028 0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305 0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028 0-3.493 1.465t-1.465 3.493z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_notification" xmlns="http://www.w3.org/2000/svg"><path d="M22.615 19.384l2.894 2.894v1.413H2.49v-1.413l2.894-2.894V12.25q0-3.365 1.716-5.856t4.745-3.231v-1.01q0-.875.606-1.514T13.999 0t1.548.639.606 1.514v1.01q3.029.74 4.745 3.231t1.716 5.856v7.134zM14 27.999q-1.211 0-2.053-.808t-.841-2.019h5.788q0 1.144-.875 1.986T14 27.999z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_path" xmlns="http://www.w3.org/2000/svg"><path d="M28 12.62h-9.793V8.414h-2.826v11.173h2.826v-4.206H28V26.62h-9.793v-4.206H12.62v-14H9.794v4.206H.001V1.381h9.793v4.206h8.413V1.381H28V12.62z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052 0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275 0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></symbol><symbol viewBox="-2.29 -2.29 36.57 36.57" id="gdoc_search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432 0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981 0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976 0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_shield" xmlns="http://www.w3.org/2000/svg"><path d="M22.167 15.166V3.5h-8.166v20.726c.93-.492 2.424-1.349 3.883-2.497 1.95-1.531 4.284-3.919 4.284-6.562zm3.499-13.999v14c0 7.674-10.737 12.523-11.192 12.724-.146.073-.31.109-.474.109s-.328-.036-.474-.109c-.456-.201-11.192-5.049-11.192-12.724v-14C2.334.529 2.863 0 3.501 0H24.5c.638 0 1.167.529 1.167 1.167z"/></symbol><symbol viewBox="-2.29 -2.29 32.57 32.57" id="gdoc_tags" xmlns="http://www.w3.org/2000/svg"><path d="M6.606 7.549c0-1.047-.84-1.887-1.887-1.887s-1.887.84-1.887 1.887.84 1.887 1.887 1.887 1.887-.84 1.887-1.887zm15.732 8.493c0 .501-.206.988-.546 1.327l-7.239 7.254c-.354.339-.84.546-1.342.546s-.988-.206-1.327-.546L1.342 14.066C.59 13.329 0 11.899 0 10.852V4.718a1.9 1.9 0 011.887-1.887h6.134c1.047 0 2.477.59 3.229 1.342L21.792 14.7c.339.354.546.84.546 1.342zm5.661 0c0 .501-.206.988-.546 1.327l-7.239 7.254c-.354.339-.84.546-1.342.546-.767 0-1.15-.354-1.651-.87l6.93-6.93c.339-.339.546-.826.546-1.327s-.206-.988-.546-1.342L13.609 4.173c-.752-.752-2.182-1.342-3.229-1.342h3.303c1.047 0 2.477.59 3.229 1.342L27.454 14.7c.339.354.546.84.546 1.342z"/></symbol></svg>



    <div class="wrapper ">
        <input type="checkbox" class="hidden" id="menu-control" />
        
        <header class="gdoc-header">
    <div class="container flex align-center justify-between">
        
        <label for="menu-control" class="gdoc-nav__control">
            <svg class="icon gdoc_menu"><use xlink:href="#gdoc_menu"></use></svg>
            <svg class="icon gdoc_arrow_back"><use xlink:href="#gdoc_arrow_back"></use></svg>
        </label>
        
        <a class="gdoc-header__link" href="https://hwangseonbi.github.io">
            <span class="gdoc-brand flex align-center">
                <img class="gdoc-brand__img" src="/brand.png" alt="">
                @hwangseonbi
            </span>
        </a>
        <span id="gdoc-dark-mode">
            <svg class="icon gdoc_brightness_dark"><use xlink:href="#gdoc_brightness_dark"></use></svg>
            <svg class="icon gdoc_brightness_light"><use xlink:href="#gdoc_brightness_light"></use></svg>
            <svg class="icon gdoc_brightness_auto"><use xlink:href="#gdoc_brightness_auto"></use></svg>
        </span>
    </div>
</header>


        <main class="container flex flex-even">
            
            <aside class="gdoc-nav">
                <nav>
    
    <div class="gdoc-search">
        <svg class="icon gdoc_search"><use xlink:href="#gdoc_search"></use></svg>
        <input type="text" id="gdoc-search-input" class="gdoc-search__input" placeholder="Search..."
            aria-label="Search" maxlength="64" />
        <div class="gdoc-search__spinner spinner hidden"></div>
        <ul id="gdoc-search-results" class="gdoc-search__list"></ul>
    </div>



    <section class="gdoc-nav--main">
        <h2>What do you want?</h2>
        
            

    

    <ul class="gdoc-nav__list">
        
            
            

            
            
            
            
            
            

            <li>
            
            <input type="checkbox" id="navtree-f8072a6c" class="gdoc-nav__toggle" >
            <label for="navtree-f8072a6c" class="flex justify-between">
            
            
                <span class="flex">Algorithm</span>
            
            
                <svg class="icon gdoc_keyborad_arrow_left"><use xlink:href="#gdoc_keyborad_arrow_left"></use></svg>
                <svg class="icon gdoc_keyborad_arrow_down hidden"><use xlink:href="#gdoc_keyborad_arrow_down"></use></svg>
            </label>
            

            
                
    

    <ul class="gdoc-nav__list">
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">
                    <a href="/Algorithm/6deb1329-a0df-4511-b16e-ead4ac2248a5/" class="gdoc-nav__entry ">
                        느낌으로 이해하는 다익스트라 최단거리 알고리즘
                    </a>
                </span>
            
            

            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">Database</span>
            
            

            
            </li>
            
            
        
            
            

            
            
            
            
            
            

            <li>
            
            <input type="checkbox" id="navtree-c2699771" class="gdoc-nav__toggle" checked>
            <label for="navtree-c2699771" class="flex justify-between">
            
            
                <span class="flex">DevOps</span>
            
            
                <svg class="icon gdoc_keyborad_arrow_left"><use xlink:href="#gdoc_keyborad_arrow_left"></use></svg>
                <svg class="icon gdoc_keyborad_arrow_down hidden"><use xlink:href="#gdoc_keyborad_arrow_down"></use></svg>
            </label>
            

            
                
    

    <ul class="gdoc-nav__list">
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">
                    <a href="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/" class="gdoc-nav__entry is-active">
                        Kubernetes configuration pattern에 대하여
                    </a>
                </span>
            
            

            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
            
            

            
            
            
            
            
            

            <li>
            
            <input type="checkbox" id="navtree-8838b740" class="gdoc-nav__toggle" >
            <label for="navtree-8838b740" class="flex justify-between">
            
            
                <span class="flex">Frontend</span>
            
            
                <svg class="icon gdoc_keyborad_arrow_left"><use xlink:href="#gdoc_keyborad_arrow_left"></use></svg>
                <svg class="icon gdoc_keyborad_arrow_down hidden"><use xlink:href="#gdoc_keyborad_arrow_down"></use></svg>
            </label>
            

            
                
    

    <ul class="gdoc-nav__list">
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">
                    <a href="/Frontend/79ac381b-6bb1-4b0b-96a2-d440d0302a78/" class="gdoc-nav__entry ">
                        [HTML &amp; CSS] Box모델에 대하여
                    </a>
                </span>
            
            

            
            </li>
            
            
        
    </ul>

            
            </li>
            
            
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">Posts</span>
            
            

            
            </li>
            
            
        
            
            

            
            
            
            
            
            

            <li>
            
            
                <span class="flex">생각</span>
            
            

            
            </li>
            
            
        
    </ul>





        
    </section>

    <section class="gdoc-nav--more">
        
    </section>
</nav>

            </aside>
            

            <div class="gdoc-page">
                
    


    






<div class="gdoc-page__header flex flex-wrap
     justify-between 
     hidden-mobile 
    " itemprop="breadcrumb">
    
    <div>
        <svg class="icon gdoc_path hidden-mobile"><use xlink:href="#gdoc_path"></use></svg>
        <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
            
            
            
            
    
    
        
        
        
        
    
    
        
        
        
        
    
    
        <li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><a itemscope itemtype='https://schema.org/WebPage' itemprop='item' itemid='/' href='/'><span itemprop='name'>@hwangseonbi</span></a><meta itemprop='position' content='1' /></li><li> / </li><li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><a itemscope itemtype='https://schema.org/WebPage' itemprop='item' itemid='/DevOps/' href='/DevOps/'><span itemprop='name'>DevOps</span></a><meta itemprop='position' content='2' /></li><li> / </li><li itemprop='itemListElement' itemscope itemtype='https://schema.org/ListItem'><span itemprop='name'>Kubernetes configuration pattern에 대하여</span><meta itemprop='position' content='3' /></li>
    

    

    

        </ol>
    </div>
    
    
</div>

    <article class="gdoc-markdown gdoc-markdown__align--left">
        <h1>Kubernetes configuration pattern에 대하여</h1>
        


  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-envvar-configuration">1. EnvVar Configuration</a></li>
    <li><a href="#2-configuration-resouece">2. Configuration Resouece</a></li>
    <li><a href="#3-immutable-configuration">3. Immutable Configuration</a>
      <ul>
        <li>
          <ul>
            <li><a href="#1-docker">1) Docker</a></li>
            <li><a href="#2-kubernetes">2) Kubernetes</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-configuration-template">4. Configuration Template</a></li>
  </ul>
</nav><hr></div>


<hr>
<blockquote>
<p><em><strong>Kubernetes Pattern<br>Part IV. Configuration Patterns 참고</strong></em></p>
</blockquote>
<div class="gdoc-page__anchorwrap">
    <h1 id="1-envvar-configuration">
        1. EnvVar Configuration
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#1-envvar-configuration" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 1. EnvVar Configuration" href="#1-envvar-configuration">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h1>
</div><p>가장 간단한 방법이다. Config Data의 개수가 적고 단순할 때 사용하기 적합하다.</p>
<br>
<ol>
<li>default ENV는 이미지에 정의해준다.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Docker" data-lang="Docker"><span class="k">FROM</span><span class="s"> ubuntu:latest</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> BACKEND_URL <span class="s2">&#34;/backend&#34;</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> <span class="nv">PROFILE</span> <span class="o">=</span> <span class="s2">&#34;DEV&#34;</span><span class="err">
</span><span class="err"></span>...</code></pre></td></tr></table>
</div>
</div>
<br>
<ol>
<li>어플리케이션에서 접근한다.
환경변수로 PROFILE만 주입해주고 어플리케이션 내부에서 PROFILE에 따라 다른 config를 불러오는 것도 하나의 방법이다. (많이 쓰임)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">contentsTableRefresh</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">BACKEND_URL</span><span class="si">}</span><span class="sb">/videos/contents`</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div>
<br>
<ol>
<li>Kubernetes 정의 파일에서 env를 주입한다. 문자열로 직접 삽입할 수도 있으며 configMap이나 Secret을 참조하여 받아올 수도 있다.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">random-generator</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">my/jsproject:1.0</span><span class="w">
</span><span class="w">		</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">jsproject</span><span class="w">
</span><span class="w">		</span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">		</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">BACKEND_URL</span><span class="w">
</span><span class="w">		  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8080</span><span class="w">
</span><span class="w">		</span>- <span class="nt">name </span><span class="p">:</span><span class="w"> </span><span class="l">PROFILE</span><span class="w">
</span><span class="w">			</span><span class="nt">valueFrom</span><span class="p">:</span><span class="w"> </span><span class="l">... </span></code></pre></td></tr></table>
</div>
</div>
<br>
<p>장점</p>
<ul>
<li>
<p>간편하다.</p>
</li>
<li>
<p>어떤 어플리케이션이든, 어떤 베이스 이미지든 통용되므로 범용성이 좋다.</p>
</li>
</ul>
<br>
<p>단점</p>
<ul>
<li>
<p>안전하지 않다.</p>
</li>
<li>
<p>복잡한 Config를 다루기에는 맞지 않다. (그 많은걸 어떻게 다 핸들링할것인가!)</p>
</li>
<li>
<p>ENV를 주입할 수 있는 계층이 나눠져 있어서 디버깅하기 어렵다. (Image에서 정의될 수도, K8S정의에서 정의될 수도, APP에서 정의될 수도 있으니..)</p>
</li>
<li>
<p>Immutable 하다. 즉 APP이 시작되기 전에 세팅되서 나중에 변경하기 힘들다. → Rolling update할 때 config 바뀔일이 없으니 장점일 수도? 암튼!</p>
</li>
</ul>
<br>
<br>
<div class="gdoc-page__anchorwrap">
    <h1 id="2-configuration-resouece">
        2. Configuration Resouece
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#2-configuration-resouece" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 2. Configuration Resouece" href="#2-configuration-resouece">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h1>
</div><p>위 EnvVar Configuration 패턴에서 조금 변형된 패턴이다.</p>
<p>이 패턴을 사용하면 좋은 점</p>
<ul>
<li>
<p>config로 사용할 데이터들을 하나의 지점에서 관리할 수 있다.</p>
</li>
<li>
<p>configMap을 Pod에서 파일로 마운트 시키면 configMap 변경 사항이 반영되게 할 수도 있다.</p>
</li>
</ul>
<br>
<p>EnvVar Conf 패턴에서는 Pod 정의에 env를 직접 문자열로 때려넣었다면 이 패턴에서는 K8S 네이티브 리소스인 ConfigMap과 Secret를 사용하여 넣는 것이다. ConfigMap과 Secret은 기술적으로는 동일하고 사용법도 동일하다.</p>
<br>
<p>물론 제한 사항도 있으니 체크필요! (ex. Secret은 1MB 제한)</p>
<br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span><span class="w">
</span><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">BACKEND_URL</span><span class="p">:</span><span class="w"> </span><span class="l">/backend</span><span class="w">
</span><span class="w">	</span><span class="nt">application.properties</span><span class="p">:</span><span class="w"> </span><span class="l">|</span><span class="w">
</span><span class="w">		</span><span class="c"># App properties config</span><span class="w">
</span><span class="w">			</span><span class="l">log.file=/tmp/myapp.log</span><span class="w">
</span><span class="w">			</span><span class="l">server.port=7070</span><span class="w">
</span><span class="w">	</span><span class="nt">EXTRA_OPTIONS</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;high-secure,native&#34;</span><span class="w">
</span><span class="w"></span><span class="nn">...</span></code></pre></td></tr></table>
</div>
</div>
<br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">random-generator</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">my/application:1.0</span><span class="w">
</span><span class="w">		</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapplication</span><span class="w">
</span><span class="w">		</span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">		</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span><span class="w">			</span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/config</span><span class="w">
</span><span class="w">	</span>- <span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">		</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">BACKEND_URL</span><span class="w">
</span><span class="w">			</span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span><span class="w">				</span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span><span class="w">					</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span><span class="w">
</span><span class="w">					</span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">BACKEND_URL</span><span class="w">
</span><span class="w">				</span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l">CONFIG_</span><span class="w">
</span><span class="w">	</span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-volume</span><span class="w">
</span><span class="w">		</span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span><span class="w">			</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span></code></pre></td></tr></table>
</div>
</div>
<br>
<br>
<br>
<br>
<div class="gdoc-page__anchorwrap">
    <h1 id="3-immutable-configuration">
        3. Immutable Configuration
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#3-immutable-configuration" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 3. Immutable Configuration" href="#3-immutable-configuration">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h1>
</div><p>이 패턴을 사용하면 좋은점</p>
<ul>
<li>
<p>Immutability 컨트롤 가능</p>
<ul>
<li>envVar config 패턴에서는 immutability가 패시브로 강제였지만 여기서의 immutability는 원하는 시점에 immutable하게 할 수 있다는 뜻. 예를들면 어플리케이션이 시작되고나면 바꿀수 없게 한다던지.</li>
</ul>
</li>
<li>
<p>config의 버전관리 가능</p>
</li>
<li>
<p>ConfigMap이나 Secret의 용량제한을 뛰어넘을 수 있음</p>
</li>
</ul>
<br>
<p>How?</p>
<p>config 관리 컨테이너 이미지를 만들어놓고 어플리케이션 런타임 때 이 컨테이너를 참조한다. 참조하는 방법은 플랫폼에 따라서 다양한 방법으로 가능.</p>
<br>
<div class="gdoc-page__anchorwrap">
    <h3 id="1-docker">
        1) Docker
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#1-docker" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 1) Docker" href="#1-docker">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h3>
</div><p>volume-from 옵션으로 다른 컨테이너의 volume 참조</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Bash" data-lang="Bash">docker create --name config-dev myapplication-config-dev:1.0.1
docker run --volume-from config-dev myapplication:1.0

docker create --name config-prdt myapplication-config-prdt:1.0.1
docker run --volume-from config-prdt myapplication:1.0</code></pre></td></tr></table>
</div>
</div>















<div class="flex justify-center">
<figure class="gdoc-markdown__figure">
    <a class="gdoc-markdown__link--raw" href="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/44f6bafc-fe47-4085-9180-8cccaea3d833.png">
        <picture>
            <source srcset="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/44f6bafc-fe47-4085-9180-8cccaea3d833_hubf5c55cacc2bb16fa2d3ef48b93126a7_343228_1800x0_resize_box_2.png" />
            <img src="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/44f6bafc-fe47-4085-9180-8cccaea3d833_hubf5c55cacc2bb16fa2d3ef48b93126a7_343228_1800x0_resize_box_2.png" alt="" />
        </picture>
    </a>
    
</figure>
</div>


<br>
<div class="gdoc-page__anchorwrap">
    <h3 id="2-kubernetes">
        2) Kubernetes
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#2-kubernetes" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 2) Kubernetes" href="#2-kubernetes">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h3>
</div><p>Kubernetes에서는 Docker의 volume-from 같은 명령을 지원하지 않는다. 다른 방법이 있는데 Init Container을 사용하면 된다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Docker" data-lang="Docker"><span class="k">FROM</span><span class="s"> busybox</span><span class="err">
</span><span class="err"></span><span class="k">ADD</span> dev.properties /config-src/demo.properties<span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">,</span> <span class="s2">&#34;cp /config-src/* $1&#34;</span><span class="p">,</span> <span class="s2">&#34;--&#34;</span><span class="p">]</span></code></pre></td></tr></table>
</div>
</div>
<br>
<p>Deployment의 Pod 템플릿에서는 하나의 volume과 두개의 컨테이너를 가지게된다.</p>















<div class="flex justify-center">
<figure class="gdoc-markdown__figure">
    <a class="gdoc-markdown__link--raw" href="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/6ab83552-31ec-4a8c-8ce7-9206e5f0e290.png">
        <picture>
            <source srcset="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/6ab83552-31ec-4a8c-8ce7-9206e5f0e290_huc881a29f2f1a3a12e60845837c6d6f49_170871_1800x0_resize_box_2.png" />
            <img src="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/6ab83552-31ec-4a8c-8ce7-9206e5f0e290_huc881a29f2f1a3a12e60845837c6d6f49_170871_1800x0_resize_box_2.png" alt="" />
        </picture>
    </a>
    
</figure>
</div>


<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="nn">...</span><span class="w">
</span><span class="w"></span><span class="nt">initContainers</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">k8s/patterns/config-dev:1</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">init</span><span class="w">
</span><span class="w">	</span><span class="nt">args</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="s2">&#34;/config&#34;</span><span class="w">
</span><span class="w">	</span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/config&#34;</span><span class="w">
</span><span class="w">		</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w"></span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">k8spatterns/demo:1</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">demo</span><span class="w">
</span><span class="w">	</span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">		</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span><span class="w">		</span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">	</span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">	</span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/config&#34;</span><span class="w">
</span><span class="w">		</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w">	</span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>&ldquo;config-directory&quot;라는 이름의 volume을 통해서 initContainers를 거쳐 실제 app 컨테이너로 config가 카피된다.</li>
</ul>
<br>
<p>만약 config를 현재 dev에서 prdt로 바꾸고 싶다면, init container의 image만 바꾸면 된다. (yaml을 통해서든 kubectl을 통해서든) 근데 이방법도 안전하지 않은데?? 그리고 hot reload도 안될듯..</p>
<br>
<p>OpenShift Template에서는 이 부분은 쉽게 파라미터를 넘기는 식으로 사용가능하다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-YAML" data-lang="YAML"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Template</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">demo</span><span class="w">
</span><span class="w"></span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">CONFIG_IMAGE</span><span class="w">
</span><span class="w">	</span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">Name of configuration image</span><span class="w">
</span><span class="w">	</span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">k8spatterns/config-dev:1</span><span class="w">
</span><span class="w"></span><span class="nt">objects</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w">	</span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DeploymentConfig</span><span class="w">
</span><span class="w">	</span><span class="l">// ...</span><span class="w">
</span><span class="w">		</span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">			</span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">				</span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">				</span><span class="l">//...</span><span class="w">
</span><span class="w">					</span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">						</span><span class="nt">initContainers</span><span class="p">:</span><span class="w">
</span><span class="w">						</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">init</span><span class="w">
</span><span class="w">							</span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">${CONFIG_IMAGE}</span><span class="w">
</span><span class="w">							</span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;/config&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">							</span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">							</span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/config</span><span class="w">
</span><span class="w">								</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w">						</span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">						</span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">k8spatterns/demo:1</span><span class="w">
</span><span class="w">							</span><span class="l">//...</span><span class="w">
</span><span class="w">							</span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">							</span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/config</span><span class="w">
</span><span class="w">								</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w">				</span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">				</span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">config-directory</span><span class="w">
</span><span class="w">					</span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}</code></pre></td></tr></table>
</div>
</div>
<br>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Bash" data-lang="Bash">oc new-app demp -p <span class="nv">CONFIG_IMAGE</span><span class="o">=</span>k8spatterns/config-prod:1</code></pre></td></tr></table>
</div>
</div>
<br>
<br>
<p>책에서 말하는 장점과 단점은 아래와 같다.</p>
<p>장점</p>
<ul>
<li>
<p>container 내부에 config가 들어있으므로 버전관리가 가능하다.</p>
</li>
<li>
<p>Configuration created this way can be distributed over a container registry. The configuration can be examined even without accessing the cluster.
→ &ldquo;config는 컨테이너 레지스트리를 넘어서 배포가 되므로 클러스터에 직접 접근하지 않아도 확인가능하 다.&rdquo; 라는 말인데, 흠&hellip; 두가지  때문에 이말을 한것같은데 확실하게 모르겠다.</p>
</li>
</ul>
<ol>
<li>클러스터 내부로 들어가지 않아도 컨테이너 레지스트리에 접근 가능해서 하는 말이거나(몰랐음ㅋ)</li>
<li>컨테이너 레지스트리 파일시스템에서 확인 가능하므로 하는 말이거나</li>
</ol>
<ul>
<li>
<p>config가 컨테이너 이미지 안에 들어있으므로 Immutable하다.</p>
</li>
<li>
<p>복잡한 config도 다루기 쉬움. 사이즈가 큰 파일도 가능.</p>
</li>
</ul>
<p>단점</p>
<ul>
<li>
<p>라이프사이클이 복잡함, 이미지 빌드 관리 포인트가 늘어남.</p>
</li>
<li>
<p>민감한 데이터에 대한 concern이 없음.</p>
</li>
<li>
<p>환경 별로 다른 deployment가 필요. (또는 수정 필요)</p>
</li>
</ul>
<br>
<br>
<div class="gdoc-page__anchorwrap">
    <h1 id="4-configuration-template">
        4. Configuration Template
        <a data-clipboard-text="https://hwangseonbi.github.io/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/#4-configuration-template" class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 4. Configuration Template" href="#4-configuration-template">
            <svg class="icon gdoc_link"><use xlink:href="#gdoc_link"></use></svg>
        </a>
    </h1>
</div><p>이 패턴은 3. Immutable Configuration에서 조금 진화된 것이라고 보면된다. 매우 복잡한 config이고 환경별로 거의 비슷한 config data를 가진다면 중복되는 부분이 많을 것이다. 따라서 일부 다른 부분만 바꿔주고 나머지 동일한 부분은 중복되어 리소스낭비를 줄일 수 있다.</p>
<br>
<p>이 일을 하는 Configuration Template Tool들을 init container에서 사용하면 된다. Tiller (Ruby) or Gomplate (Go) 같은 것들이 있다.</p>















<div class="flex justify-center">
<figure class="gdoc-markdown__figure">
    <a class="gdoc-markdown__link--raw" href="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/5f08aace-f8c6-43de-a1da-33aa8d66e2c6.png">
        <picture>
            <source srcset="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/5f08aace-f8c6-43de-a1da-33aa8d66e2c6_huffa57036210b23fa3bcb55893736a4cf_218536_1800x0_resize_box_2.png" />
            <img src="/DevOps/1688b1f5-d4f2-4c98-9940-ab8592717211/5f08aace-f8c6-43de-a1da-33aa8d66e2c6_huffa57036210b23fa3bcb55893736a4cf_218536_1800x0_resize_box_2.png" alt="" />
        </picture>
    </a>
    
</figure>
</div>


<p>이 패턴은 복잡성 때문에 config data가 매우 큰 경우에만 사용하는게 좋을 것이다.</p>
<br>


    </article>

                








    
    

    





<div class="gdoc-page__footer flex flex-wrap justify-between">
    
    
</div>

            </div>
        </main>

        <footer class="gdoc-footer">

    <script src="https://utteranc.es/client.js" repo="hwangseonbi/hwangseonbi.github.io.comments" issue-term="pathname"
        theme="github-dark" crossorigin="anonymous" async>
    </script>

</footer>
    </div>

    




<script defer src="/js/en.search.min.0fdb21b4f2f2992a9eaba1eedd19a41ab5386f9c904385be7dd185fb2de1ea11.js"></script>



<script defer src="/js/clipboard-27784b7376.min.js"></script>
<script defer src="/js/clipboard-loader-f0b5fbd5f6.min.js"></script>


</body>
</html>
